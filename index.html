<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üöö Solana France - Dashboard Logistique PRO</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif;}
    body{background:linear-gradient(135deg,#f5f7fa 0%,#e2e8f0 100%);color:#1f2937;min-height:100vh;}

    /* LOGIN */
    .login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#00b4d8,#0077b6);display:flex;align-items:center;justify-content:center;z-index:1000;}
    .login-card{background:#fff;border-radius:24px;padding:50px 60px;box-shadow:0 30px 60px rgba(0,0,0,.3);max-width:450px;width:90%;text-align:center;}
    .login-card h1{font-size:2.5rem;color:#0077b6;margin-bottom:15px;}
    .login-input{width:100%;padding:18px;border:2px solid #e5e7eb;border-radius:16px;font-size:18px;margin:20px 0;box-shadow:0 4px 12px rgba(0,0,0,.1);}
    .login-btn{width:100%;padding:18px;background:#00b4d8;color:white;border:none;border-radius:16px;font-size:18px;font-weight:700;cursor:pointer;box-shadow:0 10px 25px rgba(0,180,216,.4);transition:all .3s;}
    .login-btn:hover{transform:translateY(-3px);box-shadow:0 15px 35px rgba(0,180,216,.5);}

    /* DASHBOARD */
    .dashboard{display:none;padding:30px;max-width:1400px;margin:0 auto;}
    .header{position:relative;background:#fff;border-radius:24px 24px 0 0;padding:35px 40px;box-shadow:0 20px 40px rgba(0,0,0,.15);margin:-30px -30px 0;}
    .header h1{font-size:2.3rem;color:#0077b6;margin-bottom:10px;}
    .logout-btn{position:absolute;top:35px;right:40px;background:#ef4444;color:white;border:none;padding:12px 24px;border-radius:12px;cursor:pointer;font-weight:600;box-shadow:0 5px 15px rgba(239,68,68,.4);}

    /* KPI */
    .kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:25px;margin:35px 0;}
    .kpi-card{background:#fff;border-radius:20px;padding:30px;box-shadow:0 15px 35px rgba(0,0,0,.12);text-align:center;transition:all .3s;cursor:pointer;}
    .kpi-card:hover{transform:translateY(-8px);box-shadow:0 25px 50px rgba(0,0,0,.2);}
    .kpi-icon{font-size:4rem;margin-bottom:15px;}
    .kpi-value{font-size:3rem;font-weight:800;color:#0077b6;margin-bottom:8px;}
    .kpi-label{font-size:1.1rem;color:#6b7280;font-weight:500;}

    /* FORMULAIRE AJOUT */
    .add-section{background:#fff;border-radius:20px;padding:35px;box-shadow:0 15px 35px rgba(0,0,0,.12);margin:30px 0;}
    .add-form{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;}
    .form-group label{font-weight:600;color:#374151;margin-bottom:8px;display:block;}
    .form-input{width:100%;padding:15px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;transition:border .3s;box-shadow:0 2px 8px rgba(0,0,0,.05);}
    .form-input:focus{border-color:#00b4d8;outline:none;box-shadow:0 0 0 3px rgba(0,180,216,.1);}
    .add-btn{grid-column:1/-1;padding:20px;background:#10b981;color:white;border:none;border-radius:16px;font-size:18px;font-weight:700;cursor:pointer;box-shadow:0 10px 25px rgba(16,185,129,.4);transition:all .3s;}
    .add-btn:hover{transform:translateY(-3px);box-shadow:0 15px 35px rgba(16,185,129,.5);}

    /* TABLEAU */
    .table-container{overflow-x:auto;background:#fff;border-radius:20px;padding:30px;box-shadow:0 15px 35px rgba(0,0,0,.12);margin:30px 0;}
    table{width:100%;border-collapse:collapse;}
    th{padding:20px 15px;background:linear-gradient(135deg,#f8fafc,#f1f5f9);color:#374151;font-weight:700;font-size:1rem;border-bottom:4px solid #e5e7eb;}
    td{padding:18px 15px;border-bottom:2px solid #f3f4f6;vertical-align:middle;}
    tr:hover{background:#f8fafc;}
    tr.chargee{background:#f0fdf4;}
    .status-badge{padding:8px 16px;border-radius:25px;font-weight:600;font-size:.9rem;}
    .status-en-attente{background:#fef3c7;color:#92400e;}
    .status-chargee{background:#d1fae5;color:#065f46;}
    .action-btn{min-width:140px;padding:12px 20px;border:none;border-radius:12px;cursor:pointer;font-weight:600;transition:all .3s;margin:2px;font-size:.95rem;}
    .btn-charger{background:#00b4d8;color:white;box-shadow:0 5px 15px rgba(0,180,216,.4);}
    .btn-charger:hover{background:#0284c7;transform:translateY(-2px);}
    .btn-email{background:#10b981;color:white;box-shadow:0 5px 15px rgba(16,185,129,.4);}
    .btn-email:hover{background:#059669;transform:translateY(-2px);}

    /* STATS */
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:25px;margin:35px 0;}
    .stat-card{background:#fff;border-radius:20px;padding:30px;box-shadow:0 15px 35px rgba(0,0,0,.12);}
    .stat-title{font-size:1.3rem;color:#0077b6;margin-bottom:20px;font-weight:700;}

    @media(max-width:768px){.add-form{grid-template-columns:1fr;}}
  </style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-card">
    <h1>üöö Solana Logistique PRO</h1>
    <p>Dashboard PFE - Suivi chargements</p>
    <input type="password" id="loginPassword" class="login-input" placeholder="solanaexport2026">
    <button class="login-btn" onclick="login()">üîì ACC√âDER AU DASHBOARD</button>
  </div>
</div>

<!-- DASHBOARD PRO -->
<div class="dashboard" id="dashboardMain">
  <div class="header">
    <h1>üìä Dashboard Suivi Chargements</h1>
    <p><strong id="totalCommandes">0</strong> commandes | Mise √† jour: <span id="updateTime"></span></p>
    <button class="logout-btn" onclick="logout()">‚ùå D√©connexion</button>
  </div>

  <!-- FORMULAIRE AJOUT COMMANDE -->
  <div class="add-section">
    <h2 style="color:#0077b6;margin-bottom:25px;font-size:1.8rem;">‚ûï Nouvelle commande</h2>
    <form class="add-form" onsubmit="ajouterCommande(event)">
      <div class="form-group">
        <label>Client</label>
        <input type="text" id="client" class="form-input" required>
      </div>
      <div class="form-group">
        <label>R√©f√©rence commande</label>
        <input type="text" id="ref" class="form-input" required>
      </div>
      <div class="form-group">
        <label>Date chargement</label>
        <input type="date" id="dateCharge" class="form-input" required>
      </div>
      <div class="form-group">
        <label>D√©p√¥t (d√©pt)</label>
        <input type="text" id="depot" class="form-input" required>
      </div>
      <div class="form-group">
        <label>Pays destination</label>
        <select id="pays" class="form-input" required>
          <option value="PT">Portugal</option>
          <option value="ES">Espagne</option>
          <option value="FR">France</option>
          <option value="MA">Maroc</option>
        </select>
      </div>
      <div class="form-group">
        <label>Tonnage</label>
        <input type="number" id="tonnage" step="0.01" class="form-input" required>
      </div>
      <div class="form-group">
        <label>Immatriculation camion</label>
        <input type="text" id="immat" class="form-input">
      </div>
      <div class="form-group">
        <label>Email client (optionnel)</label>
        <input type="email" id="emailClient" class="form-input" placeholder="client@solana.de">
      </div>
      <button type="submit" class="add-btn">‚ûï AJOUTER COMMANDE</button>
    </form>
  </div>

  <!-- KPI -->
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-icon">üì¶</div>
      <div class="kpi-value" id="totalTonnages">0 T</div>
      <div class="kpi-label">Tonnes totales</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">‚è≥</div>
      <div class="kpi-value" id="attenteCount">0</div>
      <div class="kpi-label">En attente</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">‚úÖ</div>
      <div class="kpi-value" id="chargeeCount">0</div>
      <div class="kpi-label">Charg√©es</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">üìß</div>
      <div class="kpi-value" id="emailSent">0</div>
      <div class="kpi-label">Emails envoy√©s</div>
    </div>
  </div>

  <!-- TABLEAU COMMANDES -->
  <div class="table-container">
    <h2 style="color:#0077b6;margin-bottom:20px;font-size:1.8rem;">üìã Liste des commandes</h2>
    <table>
      <thead>
        <tr>
          <th>Client</th>
          <th>R√©f</th>
          <th>Date</th>
          <th>D√©p√¥t</th>
          <th>Pays</th>
          <th>Tonnages</th>
          <th>Immatriculation</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="commandesTable"></tbody>
    </table>
  </div>

  <!-- STATS D√âTAILL√âES -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3>üìà Chargements par d√©p√¥t</h3>
      <div id="statsDepot"></div>
    </div>
    <div class="stat-card">
      <h3>üåç Par destination</h3>
      <div id="statsPays"></div>
    </div>
  </div>
</div>

<script>
// BASE DONN√âES LOCALSTORAGE
let commandes = JSON.parse(localStorage.getItem('solanaCommandes')) || [];

// LOGIN
function login() {
  const pwd = document.getElementById('loginPassword').value;
  if (pwd === 'solanaexport2026') {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboardMain').style.display = 'block';
    refreshAll();
  } else {
    alert('‚ùå Mot de passe incorrect');
  }
}

function logout() {
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('dashboardMain').style.display = 'none';
  document.getElementById('loginPassword').value = '';
}

// AJOUT COMMANDE
function ajouterCommande(e) {
  e.preventDefault();

  const nouvelleCmd = {
    id: Date.now(),
    client: document.getElementById('client').value,
    ref: document.getElementById('ref').value,
    date: document.getElementById('dateCharge').value,
    depot: document.getElementById('depot').value,
    pays: document.getElementById('pays').value,
    tonnage: parseFloat(document.getElementById('tonnage').value),
    immat: document.getElementById('immat').value || '',
    statut: 'EN ATTENTE',
    emailClient: document.getElementById('emailClient').value,
    dateChargee: '',
    timestamp: new Date().toISOString()
  };

  commandes.unshift(nouvelleCmd);
  localStorage.setItem('solanaCommandes', JSON.stringify(commandes));

  // Reset form
  e.target.reset();

  refreshAll();
  alert('‚úÖ Commande ajout√©e !');
}

// MARQUER CHARG√âE + EMAIL
function marquerChargee(id) {
  const cmd = commandes.find(c => c.id === id);
  if (!cmd) return;

  cmd.statut = 'CHARG√âE';
  cmd.dateChargee = new Date().toLocaleDateString('fr-FR');

  // EMAIL AUTOMATIQUE
  const sujet = `‚úÖ Chargement ${cmd.ref} - Solana France`;
  const corps = `
Bonjour ${cmd.client},

Votre commande ${cmd.ref} a √©t√© CHARG√âE aujourd'hui !

üìã D√âTAILS:
‚Ä¢ Tonnage: ${cmd.tonnage}T
‚Ä¢ D√©p√¥t: ${cmd.depot}
‚Ä¢ Immatriculation: ${cmd.immat || 'NC'}
‚Ä¢ Destination: ${cmd.pays}
‚Ä¢ Date chargement: ${cmd.dateChargee}

Cordialement,
√âquipe Logistique Solana France
logistique@solana.de
  `.trim();

  const mailto = `mailto:${cmd.emailClient || 'logistique@solana.de'}?subject=${encodeURIComponent(sujet)}&body=${encodeURIComponent(corps)}`;
  window.location.href = mailto;

  localStorage.setItem('solanaCommandes', JSON.stringify(commandes));
  refreshAll();
}

// REFRESH COMPLET
function refreshAll() {
  // KPI
  const totalT = commandes.reduce((s, c) => s + c.tonnage, 0);
  const attente = commandes.filter(c => c.statut === 'EN ATTENTE').length;
  const chargees = commandes.filter(c => c.statut === 'CHARG√âE').length;
  const emails = commandes.filter(c => c.statut === 'CHARG√âE').length;

  document.getElementById('totalTonnages').textContent = totalT.toFixed(1) + ' T';
  document.getElementById('attenteCount').textContent = attente;
  document.getElementById('chargeeCount').textContent = chargees;
  document.getElementById('emailSent').textContent = emails;
  document.getElementById('totalCommandes').textContent = commandes.length;

  // TABLEAU
  const tbody = document.getElementById('commandesTable');
  tbody.innerHTML = '';
  commandes.forEach(cmd => {
    const tr = document.createElement('tr');
    tr.className = cmd.statut === 'CHARG√âE' ? 'chargee' : '';
    tr.innerHTML = `
      <td><strong>${cmd.client}</strong></td>
      <td>${cmd.ref}</td>
      <td>${cmd.date}</td>
      <td>${cmd.depot}</td>
      <td>${cmd.pays}</td>
      <td><strong>${cmd.tonnage.toFixed(2)} T</strong></td>
      <td>${cmd.immat || '-'}</td>
      <td><span class="status-badge status-${cmd.statut.toLowerCase().replace(/ /g,'')}">${cmd.statut}</span></td>
      <td>
        ${cmd.statut === 'EN ATTENTE' ? 
          `<button class="action-btn btn-charger" onclick="marquerChargee(${cmd.id})">
            üöõ Charger (${cmd.immat || 'Ajouter plaque'})
          </button>` :
          `<div>
            <span style="color:#10b981;font-weight:600;">‚úì Charg√©e ${cmd.dateChargee}</span><br>
            <button class="action-btn btn-email" onclick="resendEmail(${cmd.id})">üìß Re-envoyer</button>
          </div>`
        }
      </td>
    `;
    tbody.appendChild(tr);
  });

  // STATS
  const statsDepot = {};
  const statsPays = {};
  commandes.forEach(c => {
    statsDepot[c.depot] = (statsDepot[c.depot] || 0) + c.tonnage;
    statsPays[c.pays] = (statsPays[c.pays] || 0) + 1;
  });

  document.getElementById('statsDepot').innerHTML = Object.entries(statsDepot).map(([d,t]) => `<div><strong>${d}:</strong> ${t.toFixed(1)}T</div>`).join('');
  document.getElementById('statsPays').innerHTML = Object.entries(statsPays).map(([p,c]) => `<div><strong>${p}:</strong> ${c} cmd</div>`).join('');

  document.getElementById('updateTime').textContent = new Date().toLocaleString('fr-FR');
}

// RE-EMAIL
function resendEmail(id) {
  const cmd = commandes.find(c => c.id === id);
  if (cmd.emailClient) {
    const sujet = `‚úÖ Chargement ${cmd.ref} - Solana France`;
    const corps = `Votre commande ${cmd.ref} (${cmd.tonnage}T) charg√©e le ${cmd.dateChargee} - Immat: ${cmd.immat}`;
    window.location.href = `mailto:${cmd.emailClient}?subject=${encodeURIComponent(sujet)}&body=${encodeURIComponent(corps)}`;
  }
}

// INIT
refreshAll();
setInterval(refreshAll, 300000); // 5min
</script>
</body>
</html>
