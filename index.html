<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üöö Solana France - Dashboard Logistique PRO</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif;}
    body{background:linear-gradient(135deg,#f5f7fa 0%,#e2e8f0 100%);color:#1f2937;min-height:100vh;}
    .login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#00b4d8,#0077b6);display:flex;align-items:center;justify-content:center;z-index:1000;}
    .login-card{background:#fff;border-radius:24px;padding:50px 60px;box-shadow:0 30px 60px rgba(0,0,0,.3);max-width:450px;width:90%;text-align:center;}
    .login-card h1{font-size:2.5rem;color:#0077b6;margin-bottom:15px;}
    .login-input{width:100%;padding:18px;border:2px solid #e5e7eb;border-radius:16px;font-size:18px;margin:20px 0;box-shadow:0 4px 12px rgba(0,0,0,.1);}
    .login-btn{width:100%;padding:18px;background:#00b4d8;color:white;border:none;border-radius:16px;font-size:18px;font-weight:700;cursor:pointer;box-shadow:0 10px 25px rgba(0,180,216,.4);transition:all .3s;}
    .login-btn:hover{transform:translateY(-3px);box-shadow:0 15px 35px rgba(0,180,216,.5);}
    .dashboard{display:none;padding:30px;max-width:1400px;margin:0 auto;}
    .header{position:relative;background:#fff;border-radius:24px 24px 0 0;padding:35px 40px;box-shadow:0 20px 40px rgba(0,0,0,.15);margin:-30px -30px 0;}
    .header h1{font-size:2.3rem;color:#0077b6;margin-bottom:10px;}
    .logout-btn{position:absolute;top:35px;right:40px;background:#ef4444;color:white;border:none;padding:12px 24px;border-radius:12px;cursor:pointer;font-weight:600;box-shadow:0 5px 15px rgba(239,68,68,.4);}
    .kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:25px;margin:35px 0;}
    .kpi-card{background:#fff;border-radius:20px;padding:30px;box-shadow:0 15px 35px rgba(0,0,0,.12);text-align:center;transition:all .3s;cursor:pointer;}
    .kpi-card:hover{transform:translateY(-8px);box-shadow:0 25px 50px rgba(0,0,0,.2);}
    .kpi-icon{font-size:4rem;margin-bottom:15px;}
    .kpi-value{font-size:3rem;font-weight:800;color:#0077b6;margin-bottom:8px;}
    .kpi-label{font-size:1.1rem;color:#6b7280;font-weight:500;}
    .add-section{background:#fff;border-radius:20px;padding:35px;box-shadow:0 15px 35px rgba(0,0,0,.12);margin:30px 0;}
    .add-form{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;}
    .form-group label{font-weight:600;color:#374151;margin-bottom:8px;display:block;}
    .form-input{width:100%;padding:15px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;transition:border .3s;box-shadow:0 2px 8px rgba(0,0,0,.05);}
    .form-input:focus{border-color:#00b4d8;outline:none;box-shadow:0 0 0 3px rgba(0,180,216,.1);}
    .add-btn{grid-column:1/-1;padding:20px;background:#10b981;color:white;border:none;border-radius:16px;font-size:18px;font-weight:700;cursor:pointer;box-shadow:0 10px 25px rgba(16,185,129,.4);transition:all .3s;}
    .add-btn:hover{transform:translateY(-3px);box-shadow:0 15px 35px rgba(16,185,129,.5);}
    .table-container{overflow-x:auto;background:#fff;border-radius:20px;padding:30px;box-shadow:0 15px 35px rgba(0,0,0,.12);margin:30px 0;}
    table{width:100%;border-collapse:collapse;}
    th{padding:20px 15px;background:linear-gradient(135deg,#f8fafc,#f1f5f9);color:#374151;font-weight:700;font-size:1rem;border-bottom:4px solid #e5e7eb;}
    td{padding:18px 15px;border-bottom:2px solid #f3f4f6;vertical-align:middle;}
    tr:hover{background:#f8fafc;}
    tr.chargee{background:#f0fdf4;}
    .status-badge{padding:8px 16px;border-radius:25px;font-weight:600;font-size:.9rem;}
    .status-en-attente{background:#fef3c7;color:#92400e;}
    .status-chargee{background:#d1fae5;color:#065f46;}
    .action-btn{min-width:140px;padding:12px 20px;border:none;border-radius:12px;cursor:pointer;font-weight:600;transition:all .3s;margin:2px;font-size:.95rem;}
    .btn-charger{background:#00b4d8;color:white;box-shadow:0 5px 15px rgba(0,180,216,.4);}
    .btn-charger:hover{background:#0284c7;transform:translateY(-2px);}
    .btn-email{background:#10b981;color:white;box-shadow:0 5px 15px rgba(16,185,129,.4);}
    .btn-email:hover{background:#059669;transform:translateY(-2px);}
    .btn-resent{background:#f59e0b;color:white;box-shadow:0 5px 15px rgba(245,158,11,.4);}
    .btn-resent:hover{background:#d97706;transform:translateY(-2px);}
  </style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-card">
    <h1>üöö Solana Logistique</h1>
    <p>Mot de passe: <strong>solana123</strong></p>
    <input type="password" id="loginPassword" class="login-input" placeholder="solana123">
    <button class="login-btn" onclick="login()">üîì ACC√âDER</button>
  </div>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dashboardMain">
  <div class="header">
    <h1>üìä Suivi Chargements Solana</h1>
    <p id="totalInfo">0 commandes | <span id="time"></span></p>
    <button class="logout-btn" onclick="logout()">‚ùå Sortie</button>
  </div>

  <!-- FORMULAIRE -->
  <div class="add-section">
    <h2 style="color:#0077b6;">‚ûï Nouvelle commande</h2>
    <form onsubmit="ajouterCmd(event)">
      <div class="form-group">
        <label>Client</label>
        <input id="clientIn" class="form-input" required>
      </div>
      <div class="form-group">
        <label>R√©f commande</label>
        <input id="refIn" class="form-input" required>
      </div>
      <div class="form-group">
        <label>Date</label>
        <input id="dateIn" type="date" class="form-input" required>
      </div>
      <div class="form-group">
        <label>Point d√©part</label>
        <input id="pointDepart" class="form-input" placeholder="76,62,29..." required>
      </div>
      <div class="form-group">
        <label>Pays</label>
        <select id="paysIn" class="form-input">
          <option value="PT">Portugal</option>
          <option value="MA">Maroc</option>
          <option value="FR">France</option>
        </select>
      </div>
      <div class="form-group">
        <label>Tonnes</label>
        <input id="tonnesIn" type="number" step="0.01" class="form-input" required>
      </div>
      <div class="form-group">
        <label>Immatriculation</label>
        <input id="immatIn" class="form-input" placeholder="AB-123-CD">
      </div>
      <div class="form-group">
        <label>Email client</label>
        <input id="emailIn" type="email" class="form-input" required>
      </div>
      <button type="submit" class="add-btn">‚ûï AJOUTER</button>
    </form>
  </div>

  <!-- KPI -->
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-icon">üì¶</div>
      <div class="kpi-value" id="totT">0 T</div>
      <div>Total tonnes</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">‚è≥</div>
      <div class="kpi-value" id="att">0</div>
      <div>En attente</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">‚úÖ</div>
      <div class="kpi-value" id="cha">0</div>
      <div>Charg√©es</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">üìß</div>
      <div class="kpi-value" id="em">0</div>
      <div>Emails</div>
    </div>
  </div>

  <!-- TABLEAU -->
  <div class="table-container">
    <h2 style="color:#0077b6;">üìã Commandes</h2>
    <table>
      <thead>
        <tr>
          <th>Client</th><th>R√©f</th><th>Date</th><th>Point d√©part</th><th>Pays</th><th>T</th><th>Immat</th><th>Statut</th><th>Action</th>
        </tr>
      </thead>
      <tbody id="tab"></tbody>
    </table>
  </div>
</div>

<script>
// DATA PERSISTANTE
let cmds = JSON.parse(localStorage.getItem('solanaCmds')) || [];

// LOGIN
function login() {
  if (document.getElementById('loginPassword').value === 'solana123') {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboardMain').style.display = 'block';
    maj();
  } else {
    alert('‚ùå Mot de passe: solana123');
  }
}

function logout() {
  // SAUVEGARDE AUTOMATIQUE AVANT SORTIE
  localStorage.setItem('solanaCmds', JSON.stringify(cmds));
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('dashboardMain').style.display = 'none';
  document.getElementById('loginPassword').value = '';
}

// AJOUT COMMANDE
function ajouterCmd(e) {
  e.preventDefault();
  const n = {
    client: document.getElementById('clientIn').value,
    ref: document.getElementById('refIn').value,
    date: document.getElementById('dateIn').value,
    pointDepart: document.getElementById('pointDepart').value,
    pays: document.getElementById('paysIn').value,
    tonnes: parseFloat(document.getElementById('tonnesIn').value),
    immat: document.getElementById('immatIn').value,
    email: document.getElementById('emailIn').value,
    statut: 'EN ATTENTE',
    nbEmails: 0, // COMPTEUR EMAILS
    derniereDateEmail: null
  };
  cmds.unshift(n);
  localStorage.setItem('solanaCmds', JSON.stringify(cmds)); // SAUVEGARDE IMM√âDIATE
  e.target.reset();
  maj();
}

// ENVOYER EMAIL (1er ou 2√®me envoi)
function envoyerEmail(ref) {
  const c = cmds.find(x => x.ref === ref);
  
  // INCR√âMENTER COMPTEUR
  c.nbEmails++;
  c.derniereDateEmail = new Date().toLocaleDateString('fr-FR');
  c.statut = 'CHARG√âE';
  
  // MESSAGE SANS SIGNATURE
  const envoiNum = c.nbEmails;
  const sujet = `‚úÖ ${c.ref.toUpperCase()} ${envoiNum === 1 ? 'CHARG√âE' : 'RENVOY√âE'} - Solana France`;
  const msg = `${c.client},

Commande ${c.ref} ${envoiNum === 1 ? 'CHARG√âE' : 'RENVOY√âE'}!

D√âTAILS:
R√©f: ${c.ref}
Tonnes: ${c.tonnes}T
Point d√©part: ${c.pointDepart}
Immatriculation: ${c.immat}
Pays: ${c.pays}
Date: ${new Date().toLocaleDateString('fr-FR')}

${envoiNum > 1 ? `üìß Ceci est le ${envoiNum}√®me envoi.` : ''}`;

  // OUVERTURE CLIENT MAIL
  const mailtoLink = `mailto:${c.email}?subject=${encodeURIComponent(sujet)}&body=${encodeURIComponent(msg)}`;
  window.location.href = mailtoLink;
  
  localStorage.setItem('solanaCmds', JSON.stringify(cmds));
  maj();
}

// MISE A JOUR AFFICHAGE
function maj() {
  const tot = cmds.reduce((s,c) => s + c.tonnes, 0);
  const att = cmds.filter(c => c.statut === 'EN ATTENTE').length;
  const ch = cmds.filter(c => c.statut === 'CHARG√âE').length;

  document.getElementById('totT').innerHTML = tot.toFixed(1) + ' T';
  document.getElementById('att').textContent = att;
  document.getElementById('cha').textContent = ch;
  document.getElementById('em').textContent = cmds.reduce((s,c) => s + c.nbEmails, 0);
  document.getElementById('totalInfo').innerHTML = cmds.length + ' commandes | ' + new Date().toLocaleString('fr-FR');

  const tb = document.getElementById('tab');
  tb.innerHTML = '';
  
  cmds.forEach(c => {
    const tr = document.createElement('tr');
    tr.className = c.statut === 'CHARG√âE' ? 'chargee' : '';
    
    const statutText = c.statut === 'CHARG√âE' ? 
      `CHARG√âE (${c.nbEmails} email${c.nbEmails > 1 ? 's' : ''}${c.derniereDateEmail ? ` - ${c.derniereDateEmail}` : ''})` : 
      'EN ATTENTE';
    
    let btnHtml = '';
    if (c.statut === 'EN ATTENTE') {
      btnHtml = '<button class="action-btn btn-charger" onclick="envoyerEmail(\'' + c.ref + '\')">üöö CHARGER & EMAIL</button>';
    } else {
      btnHtml = '<button class="action-btn btn-resent" onclick="envoyerEmail(\'' + c.ref + '\')">üìß RENVERSER</button>';
    }
    
    tr.innerHTML = `
      <td><b>${c.client}</b></td>
      <td>${c.ref}</td>
      <td>${c.date}</td>
      <td>${c.pointDepart}</td>
      <td>${c.pays}</td>
      <td><b>${c.tonnes.toFixed(2)} T</b></td>
      <td>${c.immat}</td>
      <td style="color:${c.statut === 'CHARG√âE' ? '#10b981' : '#f59e0b'}"><b>${statutText}</b></td>
      <td>${btnHtml}</td>
    `;
    tb.appendChild(tr);
  });
}

// SAUVEGARDE AUTO PERIODIQUE
setInterval(() => {
  localStorage.setItem('solanaCmds', JSON.stringify(cmds));
}, 30000); // Toutes les 30s

// CHARGEMENT INITIAL
maj();
</script>
</body>
</html>
